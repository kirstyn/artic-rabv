# using facet_wrap creates individual plots with aligned axes
# NOTE:y axis is logged!
p + facet_wrap(~ sample, ncol=as.integer(split/4))+ theme(legend.position = "none")
?geom_bar
p=ggplot(subset(per_primer,size>=300 & size<=500 & n<100), aes(x=lab, y=log10(n))) + geom_bar(stat="count",fill="steelblue")
# using facet_wrap creates individual plots with aligned axes
# NOTE:y axis is logged!
p + facet_wrap(~ sample, ncol=as.integer(split/4))+ theme(legend.position = "none")
p
ggplot(subset(per_primer,size>=300 & size<=500 & n<100), aes(x=lab) + geom_bar(stat="count",fill="steelblue")
)
ggplot(subset(per_primer,size>=300 & size<=500 & n<100), aes(x=factor(lab))) + geom_bar(stat="count",fill="steelblue")
ggplot(subset(per_primer,size>=300 & size<=500), aes(x=factor(lab))) + geom_bar(stat="count",fill="steelblue")
geom_bar
per_primer=aln.report %>%
mutate(lab=parse_number(Primer1))%>%
summarise(group_by(PrimerPair), n=n())
per_primer=aln.report %>%
mutate(lab=parse_number(Primer1))%>%
summarise(PrimerPair, n=n())
per_primer
head(per_primer)
aln.report %>%
mutate(lab=parse_number(Primer1))%>%
count(lab)
head(aln.report)
aln.report %>%
mutate(lab=parse_number(Primer1))%>%
count(lab)
aln.report %>%
mutate(lab=parse_number(Primer1))%>%
group_by(sample)%>%
count(lab)
per_sample %>%
group_by(lab)%>%
count(lab)
per_sample=aln.report %>%
mutate(lab=parse_number(Primer1))%>%
group_by(sample)%>%
count(lab)
per_sample %>%
group_by(lab)%>%
count(lab)
head(per_sample)
per_sample %>%
group_by(lab) %>%
summarize(
count50 = length(value[n<=50]),
count100 = length(value[n<=100]),
)
per_sample %>%
group_by(lab) %>%
summarize(
count50 = length(lab[n<=50]),
count100 = length(lab[n<=100]),
)
per_primer <- per_sample %>%
group_by(lab) %>%
summarize(
count50 = length(lab[n<=50]),
count100 = length(lab[n<=100]),
)
ggplot(per_primer)
ggplot(per_primer)+ggbar(stat="count")
ggplot(per_primer)+geom_bar(stat="count")
ggplot(per_primer)+geom_bar()
ggplot(per_primer, aes(x=lab))+geom_bar()
ggplot(per_primer, aes(x=lab))+geom_bar(stat="identity")
per_primer <- per_sample %>%
group_by(lab) %>%
summarize(
count50 = length(lab[n<=50]),
count100 = length(lab[n<=100]),
)
head(per_primer)
ggplot(per_primer, aes(x=lab,y=count50))+geom_bar(stat="identity")
ggplot(per_primer, aes(x=lab,y=count100))+geom_bar(stat="identity")
per_sample
per_primer <- aln.report %>%
group_by(sample,lab) %>%
summarize(
count50 = length(lab[n<=50]),
count100 = length(lab[n<=100]),
)
per_primer <- aln.report %>%
mutate(lab=parse_number(Primer1))%>%
group_by(sample,lab) %>%
summarize(
count50 = length(lab[n<=50]),
count100 = length(lab[n<=100]),
)
aln.report %>%
mutate(lab=parse_number(Primer1))%>%
group_by(sample,lab)
aln.report %>%
mutate(lab=parse_number(Primer1))%>%
group_by(sample)%>%
count(lab)
per_primer <- per_sample %>%
group_by(lab) %>%
summarize(
count50 = length(lab[n<=50]),
count100 = length(lab[n<=100]),
)
per_primer
per_primer <- per_sample %>%
group_by(lab) %>%
summarize(
count50 = length(lab[n<=50]),
count100 = length(lab[n<=100]),
freq50= n<50/sum(n)
)
head(per_primer)
per_primer <- per_sample %>%
group_by(lab) %>%
summarize(
count50 = length(lab[n<=50]),
count100 = length(lab[n<=100]),
freq50= length(lab[n<=50])/sum(n)
)
per_primer
head(per_primer)
View(per_primr)
View(per_primr)
View(per_primer)
sum(per_primer$lab)
per_primer$lab
per_primer <- per_sample %>%
group_by(lab) %>%
summarize(
count50 = length(lab[n<=50]),
count100 = length(lab[n<=100]),
freq50= length(lab[n<=50])/length(lab)
)
per_primer <- per_sample %>%
group_by(lab) %>%
summarize(
count50 = length(lab[n<=50]),
count100 = length(lab[n<=100]),
freq50= length(lab[n<=50])/length(lab)
freq100= length(lab[n<=100])/length(lab)
)
ggplot(per_primer, aes(x=lab,y=count100))+geom_bar(stat="identity")
per_primer <- per_sample %>%
group_by(lab) %>%
summarize(
count50 = length(lab[n<=50]),
count100 = length(lab[n<=100]),
freq50= length(lab[n<=50])/length(lab),
freq100= length(lab[n<=100])/length(lab)
)%>%
melt(per_sample[,c(lab,freq50,freq100)], id.vars=1)
library(reshape2)
per_primer <- per_sample %>%
group_by(lab) %>%
summarize(
count50 = length(lab[n<=50]),
count100 = length(lab[n<=100]),
freq50= length(lab[n<=50])/length(lab),
freq100= length(lab[n<=100])/length(lab)
)%>%
melt(per_sample[,c(lab,freq50,freq100)], id.vars=1)
per_primer <- per_sample %>%
group_by(lab) %>%
summarize(
count50 = length(lab[n<=50]),
count100 = length(lab[n<=100]),
freq50= length(lab[n<=50])/length(lab),
freq100= length(lab[n<=100])/length(lab)
)%>%
melt(per_sample[,c('lab','freq50','freq100')], id.vars=1)
per_primer <- per_sample %>%
group_by(lab) %>%
summarize(
count50 = length(lab[n<=50]),
count100 = length(lab[n<=100]),
freq50= length(lab[n<=50])/length(lab),
freq100= length(lab[n<=100])/length(lab)
)%>%
melt(id.vars="lab")
head(per_primer)
ggplot(per_primer, aes(x=lab,y=value, fill=variable))+
geom_bar(stat="identity")
per_primer <- per_sample %>%
group_by(lab) %>%
summarize(
freq50= length(lab[n<=50])/length(lab),
freq100= length(lab[n<=100])/length(lab)
)%>%
melt(id.vars="lab")
ggplot(per_primer, aes(x=lab,y=value, fill=variable))+
geom_bar(stat="identity")
ggplot(per_primer, aes(x=factor(lab),y=value, fill=variable))+
geom_bar(stat="identity")
ggplot(per_primer, aes(x=factor(lab),y=value, fill=variable))+
geom_bar(stat="identity", position="dodge")
View(per_primer)
ggplot(per_primer, aes(x=factor(lab),y=value, fill=variable))+
geom_bar(stat="identity")
per_primer <- per_sample %>%
group_by(lab) %>%
summarize(
freq50= length(lab[n<=50])/length(lab),
freq100= length(lab[n<=100])/length(lab)
)
per_primer <- per_sample %>%
group_by(lab) %>%
summarize(
freq50= length(lab[n<50])/length(lab),
freq100= length(lab[n<100])/length(lab)
)
# grouped barplot for <100 or <50 reads per primer
per_primer %>%
melt(id.vars="lab") %>%
ggplot(per_primer, aes(x=factor(lab),y=value, fill=variable))+
geom_bar(stat="identity", position="dodge")
# grouped barplot for <100 or <50 reads per primer
per_primer %>%
melt(id.vars="lab") %>%
ggplot(aes(x=factor(lab),y=value, fill=variable))+
geom_bar(stat="identity", position="dodge")
ggplot(per_primer,aes(x=factor(lab),y=freq100, fill=variable))+
geom_bar(stat="identity")
library(RColorBrewer)
pal=brewer.pal(n = 8, name = "Dark2")
pal=brewer.pal(n = 8, name = "Dark2")
ggplot(per_primer,aes(x=factor(lab),y=freq50, fill=pal[1]))+
geom_bar(stat="identity")
ggplot(per_primer,aes(x=factor(lab),y=freq100, fill=pal[2]))+
geom_bar(stat="identity")
pal[1]
ggplot(per_primer,aes(x=factor(lab),y=freq100), fill=pal[2])+
geom_bar(stat="identity")
ggplot(per_primer,aes(x=factor(lab),y=freq50), fill=pal[1])+
geom_bar(stat="identity")
pal[1]
ggplot(per_primer,aes(x=factor(lab),y=freq50), fill="#1B9E77")+
geom_bar(stat="identity")
ggplot(per_primer,aes(x=factor(lab),y=freq50))+
geom_bar(stat="identity",fill=pal[1])
ggplot(per_primer,aes(x=factor(lab),y=freq100))+
geom_bar(stat="identity", fill=pal[2])
ggplot(per_primer,aes(x=factor(lab),y=freq100))+
geom_bar(stat="identity", fill=pal[2])+
coord_flip()
# grouped barplot for <100 or <50 reads per primer
per_primer %>%
melt(id.vars="lab") %>%
ggplot(aes(x=factor(lab),y=value, fill=variable))+
geom_bar(stat="identity", position="dodge")+
coord_flip()
ggplot(per_primer,aes(x=factor(lab),y=freq50))+
geom_bar(stat="identity",fill=pal[1])+
xlab("Product")+ ylab("Proportion of samples")
coord_flip()+ theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1))
ggplot(per_primer,aes(x=factor(lab),y=freq50))+
geom_bar(stat="identity",fill=pal[1])+
xlab("Product")+ ylab("Proportion of samples")+
coord_flip()+ theme(axis.text.x = element_text(angle = 45, vjust = 0.5, hjust=1))
ggplot(per_primer,aes(x=factor(lab),y=freq50))+
geom_bar(stat="identity",fill=pal[1])+
xlab("Product")+ ylab("Proportion of samples")+
coord_flip()+ theme(axis.text.y = element_text(angle = 45, vjust = 0.5, hjust=1))
ggplot(per_primer,aes(x=factor(lab),y=freq50))+
geom_bar(stat="identity",fill=pal[1])+
xlab("Product")+ ylab("Proportion of samples")+
coord_flip()+ theme(axis.text.y = element_text(size=10))
ggplot(per_primer,aes(x=factor(lab),y=freq50))+
geom_bar(stat="identity",fill=pal[1])+
xlab("Product")+ ylab("Proportion of samples")+
coord_flip()+ theme(axis.text.y = element_text(size=8))
ggplot(per_primer,aes(x=factor(lab),y=freq50))+
geom_bar(stat="identity",fill=pal[1])+
xlab("Product")+ ylab("Proportion of samples")+
coord_flip()+ theme(axis.text.y = element_text(size=6))
ggplot(per_primer,aes(x=lab,y=freq50))+
geom_bar(stat="identity",fill=pal[1])+
xlab("Product")+ ylab("Proportion of samples")+
coord_flip()+ theme(axis.text.y = element_text(size=6))
ggplot(per_primer,aes(x=lab,y=freq50))+
geom_bar(stat="identity",fill=pal[1])+
xlab("Product")+ ylab("Proportion of samples")+
coord_flip()+ theme(axis.text.y = element_text(size=6))+ scale_y_continuous(breaks=seq(0,41,2))
ggplot(per_primer,aes(x=lab,y=freq50))+
geom_bar(stat="identity",fill=pal[1])+
xlab("Product")+ ylab("Proportion of samples")+
coord_flip()+ theme(axis.text.x = element_text(size=6))+ scale_y_continuous(breaks=seq(0,41,2))
ggplot(per_primer,aes(x=lab,y=freq50))+
geom_bar(stat="identity",fill=pal[1])+
xlab("Product")+ ylab("Proportion of samples")+
coord_flip()+ theme(axis.text.y = element_text(size=6))+ scale_x_continuous(breaks=seq(0,41,2))
xlabels <- sort(unique(per_primer$lab))
xlabels[seq(2, length(xlabels), 2)] <- ""
ggplot(per_primer,aes(x=lab,y=freq50))+
geom_bar(stat="identity",fill=pal[1])+
xlab("Product")+ ylab("Proportion of samples")+
coord_flip()+ theme(axis.text.y = element_text(size=6))+ scale_x_continuous(breaks=seq(0,41,2), labels=xlabels)
xlabels
seq(0,41,2)
ggplot(per_primer,aes(x=lab,y=freq50))+
geom_bar(stat="identity",fill=pal[1])+
xlab("Product")+ ylab("Proportion of samples")+
coord_flip()+ theme(axis.text.y = element_text(size=6))+ scale_x_continuous(labels=xlabels)
ggplot(per_primer,aes(x=factor(lab),y=freq50))+
geom_bar(stat="identity",fill=pal[1])+
xlab("Product")+ ylab("Proportion of samples")+
coord_flip()+ theme(axis.text.y = element_text(size=6))+ scale_x_discrete(labels=xlabels)
ggplot(per_primer,aes(x=factor(lab),y=freq100))+
geom_bar(stat="identity", fill=pal[2])+
coord_flip()+ scale_x_discrete(labels=xlabels)
ggplot(per_primer,aes(x=factor(lab),y=freq50))+
geom_bar(stat="identity",fill=pal[1])+
labs(x="Product")
nsamples
nruns
files
files
gsub(".*_phl|ken|tza|per|nig*","",files
)
gsub(".*_phl|ken|tza|per|nig*_*","",files
)
gsub(".*_phl|ken|tza|per|nig*_*alignreport.txt","",files)
files
str_split("_",files)
?str_splot
?str_split
str_split(files, "_")
str_split(files, "_")[1:3]
str_split(files, "_")[[1:3]]
vapply(strsplit(files,"_"), `[`, 1, FUN.VALUE=character(1))
vapply(strsplit(files,"_"), `[`, 1, FUN.VALUE=character(1:3))
vapply(strsplit(files,"_"), `[`, 1:Â£, FUN.VALUE=character(1))
vapply(strsplit(files,"_"), `[`, 1:3, FUN.VALUE=character(1))
vapply(strsplit(files,"_"), `[`, c(1:3), FUN.VALUE=character(1))
files
gsub("_phl|ken|tza|per|nig*_*alignreport.txt","",files)
gsub("_phl|ken|tza|per|nig.*_*alignreport.txt","",files)
gsub("_phl|ken|tza|per|nig","",files)
gsub("_phl|ken|tza|per|nig_*","",files)
gsub("_phl|ken|tza|per|nig_.*","",files)
gsub("_phl|ken|tza|per|nig_.*txt","",files)
gsub(".*_phl|ken|tza|per|nig","",files)
gsub(".*_phl|ken|tza|per|nig_","",files)
gsub(".*_phl|ken|tza|per|nig","alignreport.txt","",files)
library(stringi)
gsub(".*_phl|ken|tza|per|nig",""
gsub("alignreport.txt",""
,files))
gsub(".*_phl|ken|tza|per|nig","",
gsub("alignreport.txt","",
files))
gsub(".*_phl|ken|tza|per|nig","",
gsub(".alignreport.txt","",
files))
gsub("_phl|ken|tza|per|nig","",
gsub(".alignreport.txt","",
files))
gsub("_phl|ken|tza|per|nig_","",
gsub(".alignreport.txt","",
files))
gsub("_phl|ken|tza|per|nig","",
gsub(".alignreport.txt","",
files))
gsub("_phl|ken|tza|per|nig*","",
gsub(".alignreport.txt","",
files))
gsub("_phl|ken|tza|per|nig","",
gsub(".alignreport.txt","",
files))
gsub("phl|ken|tza|per|nig","",
gsub(".alignreport.txt","",
files))
gsub("phl|ken|tza|per|nig","",
gsub("__.*","",
files))
gsub("phl|ken|tza|per|nig","",
gsub("__*","",
files))
gsub("phl|ken|tza|per|nig","",
gsub("__.*","",
files))
gsub("__.*","",
files)
gsub("phl|ken|tza|per|nig","",
gsub("__.*","",
files))
a=gsub("phl|ken|tza|per|nig","",files)
b=gsub("__.*","",files)
a
b=gsub("__.*","",a)
b
gsub("__.*","",
gsub("phl|ken|tza|per|nig","",
files))
files
round(nsamples/24)
#guess number of runs
nruns=roundup(nsamples/24)
?round
#guess number of runs
nruns=round(nsamples/24, digits=1)
round(nsamples/24, digits=1)
round(nsamples/24, digits=0)
#guess number of runs
nruns=round(nsamples/24, digits=0);nruns[nruns==0]=1
nruns
ggplot(per_primer,aes(x=factor(lab),y=freq50))+
geom_bar(stat="identity",fill=pal[1])+
labs(title=paste0("Based on ",nsamples," from (guessed) ", nruns), x="Product", y="Proportion of samples")+
coord_flip()+ scale_x_discrete(labels=xlabels)
ggplot(per_primer,aes(x=factor(lab),y=freq50))+
geom_bar(stat="identity",fill=pal[1])+
labs(title=paste0("Based on ",nsamples," from ~", nruns), x="Product", y="Proportion of samples")+
coord_flip()+ scale_x_discrete(labels=xlabels)
ggplot(per_primer,aes(x=factor(lab),y=freq50))+
geom_bar(stat="identity",fill=pal[1])+
labs(title=paste0("Based on ",nsamples," from ~", nruns,"runs"), x="Product", y="Proportion of samples")+
coord_flip()+ scale_x_discrete(labels=xlabels)
ggplot(per_primer,aes(x=factor(lab),y=freq50))+
geom_bar(stat="identity",fill=pal[1])+
labs(title=paste0("Based on ",nsamples," samples from ~", nruns,"runs"), x="Product", y="Proportion of samples")+
coord_flip()+ scale_x_discrete(labels=xlabels)
ggplot(per_primer,aes(x=factor(lab),y=freq50))+
geom_bar(stat="identity",fill=pal[1])+
labs(title=paste0("Based on ",nsamples," samples\nfrom ~", nruns,"runs"), x="Product", y="Proportion of samples")+
coord_flip()+ scale_x_discrete(labels=xlabels)
ggplot(per_primer,aes(x=factor(lab),y=freq50))+
geom_bar(stat="identity",fill=pal[1])+
labs(title=paste0("Proportion of Based on ",nsamples," samples\nfrom ~", nruns,"runs"), x="Product", y=NULL)+
coord_flip()+ scale_x_discrete(labels=xlabels)
freq50=ggplot(per_primer,aes(x=factor(lab),y=freq50))+
geom_bar(stat="identity",fill=pal[1])+
labs(title=paste0("Based on ",nsamples," samples\nfrom ~", nruns,"runs"), x="Product", y="Proportion of samples <50reads")+
coord_flip()+ scale_x_discrete(labels=xlabels)
freq100=ggplot(per_primer,aes(x=factor(lab),y=freq100))+
geom_bar(stat="identity", fill=pal[2])+
labs( x="Product", y="Proportion of samples <100reads")
freq100=ggplot(per_primer,aes(x=factor(lab),y=freq100))+
geom_bar(stat="identity", fill=pal[2])+
labs( x="Product", y="Proportion of samples <100reads")+
coord_flip()+ scale_x_discrete(labels=xlabels)
ggarrange(freq50,freq100)
library(ggpubr)
ggarrange(freq50,freq100)
ggarrange(freq50,freq100,nrow=1)
ggarrange(freq50,freq100, ncol=2, common.legend = TRUE, legend="bottom")
?ggarrange
grid.arrange(freq50, freq100, ncol=2)
# grouped barplot for <100 or <50 reads per primer
per_primer %>%
melt(id.vars="lab") %>%
ggplot(aes(x=factor(lab),y=value, fill=variable))+
geom_bar(stat="identity", position="dodge")+
coord_flip()
p=per_primer %>%
melt(id.vars="lab") %>%
ggplot(aes(x=factor(lab),y=value))+
geom_bar(stat="identity")+
coord_flip()
p
p + facet_grid(lab ~ .)
p + facet_grid(variable ~ .)
p + facet_grid(.~variable)
# grouped barplot for <100 or <50 reads per primer
p=per_primer %>%
melt(id.vars="lab") %>%
ggplot(aes(x=factor(lab),y=value))+
geom_bar(stat="identity")+
coord_flip()+labs( x="Product", y="Proportion of samples <100reads")
p + facet_grid(.~variable)
# grouped barplot for <100 or <50 reads per primer
p=per_primer %>%
melt(id.vars="lab") %>%
ggplot(aes(x=factor(lab),y=value))+
geom_bar(stat="identity")+
coord_flip()+labs( x="Product", y="Proportion of samples")+ scale_x_discrete(labels=xlabels)
p + facet_grid(.~variable)
seq(2, length(xlabels), 2)
xlabels[seq(1, length(xlabels), 5)] <- ""
xlabels
seq(1, length(xlabels), 5)
?seq
xlabels[seq(2, length(xlabels), 2)] <- ""
p + facet_grid(.~variable)
ggplot(aes(x=factor(lab),y=round(value))+
# grouped barplot for <100 or <50 reads per primer
p=per_primer %>%
melt(id.vars="lab") %>%
ggplot(aes(x=factor(lab),y=round(value)))+
geom_bar(stat="identity")+
coord_flip()+labs( x="Product", y="Proportion of samples")+ scale_x_discrete(labels=xlabels)
p + facet_grid(.~variable)
?round
# grouped barplot for <100 or <50 reads per primer
p=per_primer %>%
melt(id.vars="lab") %>%
ggplot(aes(x=factor(lab),y=round(value,digits=1)))+
geom_bar(stat="identity")+
coord_flip()+labs( x="Product", y="Proportion of samples")+ scale_x_discrete(labels=xlabels)
p + facet_grid(.~variable)
freqs <- list(
'freq50'="<50 reads",
'freq100'="<100 reads"
)
p + facet_grid(.~variable, labeller=freqs)
freqs
p + facet_grid(.~variable, labeller=as_labeller(freqs))
freqs <- list(
`freq50`="<50 reads",
`freq100`="<100 reads"
)
p + facet_grid(.~variable, labeller=as_labeller(freqs))
